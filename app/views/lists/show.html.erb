<% content_for :title, "#{@list.name} - Rankings" %>
<% content_for :facebook_meta_tags do %>
  <meta property="og:title" content="<%= @list.name %>"/>
  <meta property="og:url" content="<%= list_url(@list) %>"/>
  <meta property="og:image" content="<%= @list.default_image %>"/>
<% end %>
<%= form_tag v0_list_url(@list, host: api_domain, subdomain: api_subdomain), remote: true, method: :get, class: "js-lists-api-form js-list-form" do %>
<% end %>
<!-- Modal -->
<div class="row nmhxs">
  <div class="col-md-3 phxs mtm">
    <div class="paxs bg-15 fss bss bwas bc-13">
      <div>
        <%= @list.name %>
      </div>
      <div class="mtxs">
        <table>
          <tr>
            <td>
              <div class="fb-share-button" data-href="<%= list_url(@list) %>" data-layout="button"></div>
            </td>
            <td class="plxs">
              <a class="twitter-share-button" href="<%= list_url(@list) %>" data-text="<%= @list.name %> | popjova" data-count="none">Tweet</a>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="paxs mtxs bg-15 fsxs bss bwas bc-13">
      <%= pluralize(@list.contributors_count, "Contributor") %>
    </div>
    <div class="paxs mtxs bg-15 fsxs bss bwas bc-13">
      <%= pluralize(@list.products_count, "Product") %>
    </div>
    <div class="paxs mtxs bg-15 fsxs bss bwas bc-13">
      <%= list_price_range(@list) %>
    </div>
    <% if current_user %>
      <%= link_to "#" do %>
        <div class="lists-add-product mtxs">
          <div class="paxs bg-blue c-15 fsxs text-center" data-toggle="modal" data-target="#addProductModal">
            add to list
          </div>
        </div>
      <% end %>
      <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content bran">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="addProductModalLabel">Search Products</h4>
            </div>
            <div class="modal-body">
              <%= form_tag v0_products_url(host: api_domain, subdomain: api_subdomain), remote: true, class: "js-lists-api-form js-products-form-new" do %>
                <%= hidden_field_tag :type, "AmazonProduct" %>
                <%= hidden_field_tag :sku, nil, class: "js-lists-api-submit-on-change" %>
                <%= hidden_field_tag :id, nil %>
              <% end %>
              <%= form_tag add_product_v0_list_url(host: api_domain, subdomain: api_subdomain), remote: true, class: "js-lists-api-form js-lists-form-add-product" do %>
                <%= hidden_field_tag :id, @list.id %>
                <%= hidden_field_tag :user_id, current_user.id %>
                <%= hidden_field_tag :product_id, nil, data: { dependent: true, dependent_on_form: ".js-products-form-new", dependent_on_input: "id" } %>
              <% end %>
              <%= form_tag search_v0_stores_url(host: api_domain, subdomain: api_subdomain), method: :get, remote: true, class: "js-lists-api-form js-lists-form-search js-lists-form-products-search", data: { results: ".js-lists-products-search-results" } do %>
                <%= hidden_field_tag :store, "Amazon" %>
                <%= hidden_field_tag :page, 1 %>
                <%= text_field_tag :q, nil, class: "paxxxs bg-15 bss bwas bc-13 full-width js-lists-form-search-q" %>
              <% end %>
              <div class="js-lists-products-search-results"></div>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <%= link_to new_user_registration_path do %>
        <div class="lists-add-product mtxs">
          <div class="paxs bg-blue c-15 fsxs text-center" data-toggle="modal" data-target="#addProductModal">
            add to list
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
  <div class="col-md-9 phxs mtxs">
    <div class="js-list-items">
      <% @list.items_ordered_by_rank.each do |item| %>
        <div class="mtxs bss bwts bc-n js-list-item" data-id="<%= item.id %>">
          <div class="relative dvxxxxs bg-13">
            <div class="absolute left top bottom bg-blue" style="width: <%= (item.likes_count_percent * 100) %>%;"></div>
          </div>
          <div class="container-sm-height pvxs bg-15 bss bwhs bwbs bc-13">
            <div class="row row-sm-height mhn nmtxs">
              <div class="list-rank col-sm-2 col-sm-height phxs mtxs text-center">
                <div class="fsxl">
                  #<span class="js-list-item-rank"><%= item.display_rank %></span>
                </div>
                <div class="c-blue fsxxxs hidden-xs">
                  <span class="pointer js-list-item-likes" data-toggle="modal" data-target="#list-item-<%= item.id %>-likes">
                    <%= form_tag v0_list_list_item_url(@list, item, host: api_domain, subdomain: api_subdomain), method: :get, remote: true, class: "js-lists-api-form js-list-item-form-likes" do %>
                    <% end %>
                    <span class="fsxs js-likes-count" data-like-word="like" data-likable="ListItem-<%= item.id %>"><%= item.likes_count %></span> <span class="js-likes-word" data-likable="ListItem-<%= item.id %>"><%= "like".pluralize(item.likes_count) %></span>
                  </span>
                  <div class="modal fade" id="list-item-<%= item.id %>-likes" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content bran">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                          <h4 class="modal-title" id="addProductModalLabel">Likes</h4>
                        </div>
                        <div class="modal-body text-left">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-2 col-sm-height col-sm-height-top phxs mtxs bss bwls bc-13">
                <%= link_to product_path(item.product) do %>
                  <%= image_tag item.product.image.url(:profile), class: "full-width" %>
                <% end %>
              </div>
              <div class="col-sm-6 col-sm-height col-sm-height-top phxs mtxs">
                <div class="fsxs fwl">
                  <%= link_to item.product.name.html_safe, product_path(item.product) %>
                </div>
                <div class="fws">
                  <%= item.product.manufacturer %>
                </div>
                <div class="fsxxxs fws c-10">
                  added by <span class="c-blue"><%= item.user.username %></span>
                </div>
              </div>
              <div class="col-sm-2 col-sm-height col-sm-height-top phxs">
                <div class="row nmhxxxs">
                  <div class="col-xs-6 col-sm-12 phxxxs mtxs">
                    <%= link_to item.product.url do %>
                      <div class="phxxs pvxxxs bg-blue c-15 fsxxxs text-center">
                        <table class="mha">
                          <tr>
                            <td>
                              <%= number_to_currency item.product.price, precision: 0 %>
                            </td>
                            <td class="visible-xs">
                              &nbsp;on <%= item.product.store_name %>
                            </td>
                          </tr>
                        </table>
                      </div>
                    <% end %>
                  </div>
                  <div class="col-xs-6 col-sm-12 phxxxs mtxs">
                    <% if current_user %>
                      <div class="<%= "active " if current_user.likes?(item) %>js-like">
                        <div class="hide-active">
                          <%= form_tag like_v0_user_url(host: api_domain, subdomain: api_subdomain), remote: true, class: "js-lists-api-form js-likes-form-like js-list-items-like" do %>
                            <%= hidden_field_tag :likable_type, "ListItem" %>
                            <%= hidden_field_tag :likable_id, item.id %>
                            <div class="phxxs pvxxxs bg-blue c-15 fsxxxs text-center pointer js-lists-api-form-submit">
                              <table class="mha">
                                <tr>
                                  <td>
                                    <i class="fa fa-thumbs-up"></i>
                                  </td>
                                  <td class="visible-xs">
                                    &nbsp;Like
                                  </td>
                                </tr>
                              </table>
                            </div>
                          <% end %>
                        </div>
                        <div class="show-active">
                          <%= form_tag unlike_v0_user_url(host: api_domain, subdomain: api_subdomain), remote: true, class: "js-lists-api-form js-likes-form-unlike js-list-items-like" do %>
                            <%= hidden_field_tag :likable_type, "ListItem" %>
                            <%= hidden_field_tag :likable_id, item.id %>
                            <div class="phxxs pvxxxs bg-blue c-15 fsxxxs fade-m text-center pointer js-lists-api-form-submit">
                              <table class="mha">
                                <tr>
                                  <td>
                                    <i class="fa fa-thumbs-down"></i>
                                  </td>
                                  <td class="visible-xs">
                                    &nbsp;Unlike
                                  </td>
                                </tr>
                              </table>
                            </div>
                          <% end %>
                        </div>
                      </div>
                    <% else %>
                      <%= link_to new_user_registration_path do %>
                        <div class="phxxs pvxxxs bg-blue c-15 fsxxxs text-center pointer">
                          <table class="mha">
                            <tr>
                              <td>
                                <i class="fa fa-thumbs-up"></i>
                              </td>
                              <td class="visible-xs">
                                &nbsp;Like
                              </td>
                            </tr>
                          </table>
                        </div>
                      <% end %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div class="mtxl">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = "popjova";
          var disqus_identifier = "list-<%= @list.id %>";
          var disqus_title = "<%= @list.name %>";
          var disqus_url = "<%= list_url(@list) %>";

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</div>
