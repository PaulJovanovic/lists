<%= content_for :title, @list.name %>
<%= form_tag v0_list_url(@list, host: api_domain, subdomain: api_subdomain), remote: true, method: :get, class: "js-lists-api-form js-list-form" do %>
<% end %>
<div class="row nmhxs">
  <div class="col-lg-3 phxs mtm">
    <div class="fsm">
      <%= @list.name %>
    </div>
    <div class="fss">
      <i class="fa fa-twitter fa-fw pointer"></i>
      <i class="fa fa-facebook fa-fw pointer"></i>
    </div>
  </div>
  <div class="col-lg-9 phxs">
    <div class="js-list-items">
      <% @list.items.each do |item| %>
        <div class="container-sm-height pvxs mtm bg-15 bss bwas bc-13 js-list-item" data-id="<%= item.id %>">
          <div class="row row-sm-height mhn nmtxs">
            <div class="list-rank col-sm-2 col-sm-height phxs mtxs text-center">
              <div class="fsxl">
                #<span class="js-list-item-rank"><%= item.display_rank %></span>
              </div>
              <div class="c-10 fsxxxs hidden-xs">
                <span class="fsxs js-likes-count" data-likable="ListItem-<%= item.id %>"><%= item.likes_count %></span> point
              </div>
            </div>
            <div class="col-sm-2 col-sm-height col-sm-height-top phxs mtxs bss bwls bc-13">
              <%= link_to product_path(item.product) do %>
                <%= image_tag item.product.image.url(:profile), class: "img-responsive mha" %>
              <% end %>
            </div>
            <div class="col-sm-6 col-sm-height col-sm-height-top phxs mtxs">
              <div class="fsxs fwl">
                <%= link_to item.product.name, product_path(item.product) %>
              </div>
              <div class="fws">
                <%= item.product.manufacturer %>
              </div>
              <div class="fsxxxs fws c-blue">
                [ <%= item.user.username %> ]
              </div>
            </div>
            <div class="col-sm-2 col-sm-height col-sm-height-top phxs">
              <div class="row nmhxxxs">
                <div class="col-xs-6 col-sm-12 phxxxs mtxs">
                  <%= link_to item.product.url do %>
                    <div class="phxxs pvxxxs bg-1 c-15 fsxxxs text-center">
                      <table class="mha">
                        <tr>
                          <td>
                            <%= number_to_currency(item.product.price) %>
                          </td>
                          <td class="visible-xs">
                            &nbsp;on <%= item.product.store_name %>
                          </td>
                        </tr>
                      </table>
                    </div>
                  <% end %>
                </div>
                <div class="col-xs-6 col-sm-12 phxxxs mtxs">
                  <div class="<%= "active " if current_or_guest_user.likes?(item) %>js-like">
                    <div class="hide-active">
                      <%= form_tag like_v0_user_url(host: api_domain, subdomain: api_subdomain), remote: true, class: "js-lists-api-form js-likes-form-like js-list-items-like" do %>
                        <%= hidden_field_tag :likable_type, "ListItem" %>
                        <%= hidden_field_tag :likable_id, item.id %>
                        <div class="phxxs pvxxxs bg-1 c-15 fsxxxs text-center pointer js-lists-api-form-submit">
                          <table class="mha">
                            <tr>
                              <td>
                                <i class="fa fa-thumbs-up"></i>
                              </td>
                              <td class="visible-xs">
                                &nbsp;Like
                              </td>
                            </tr>
                          </table>
                        </div>
                      <% end %>
                    </div>
                    <div class="show-active">
                      <%= form_tag unlike_v0_user_url(host: api_domain, subdomain: api_subdomain), remote: true, class: "js-lists-api-form js-likes-form-unlike js-list-items-like" do %>
                        <%= hidden_field_tag :likable_type, "ListItem" %>
                        <%= hidden_field_tag :likable_id, item.id %>
                        <div class="phxxs pvxxxs bg-8 c-15 fsxxxs text-center pointer js-lists-api-form-submit">
                          <table class="mha">
                            <tr>
                              <td>
                                <i class="fa fa-thumbs-down"></i>
                              </td>
                              <td class="visible-xs">
                                &nbsp;Unlike
                              </td>
                            </tr>
                          </table>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <% if current_user %>
      <div class="paxs mtxs bg-15 bss bwas bc-13">
        <div class="fss">
          Add Product
        </div>
        <div class="mtxs ptxs bss bwts bc-13">
          <%= form_tag v0_products_url(host: api_domain, subdomain: api_subdomain), remote: true, class: "js-lists-api-form js-products-form-new" do %>
            <%= hidden_field_tag :type, "AmazonProduct" %>
            <%= hidden_field_tag :id, nil %>
            <div class="mtm-plus">
              <div class="fsxxs">
                <%= label_tag :sku %>
              </div>
              <div class="fsxs">
                <%= text_field_tag :sku, nil, class: "paxxxs bss bwas bc-8 full-width" %>
                <div class="c-red hide js-lists-api-form-error" data-input-name="product[sku]"></div>
              </div>
            </div>
          <% end %>
          <%= form_tag add_product_v0_list_url(host: api_domain, subdomain: api_subdomain), remote: true, class: "js-lists-api-form js-lists-form-add-product" do %>
            <%= hidden_field_tag :id, @list.id %>
            <%= hidden_field_tag :user_id, current_user.id %>
            <%= hidden_field_tag :product_id, nil, data: { dependent: true, dependent_on_form: ".js-products-form-new", dependent_on_input: "id" } %>
            <div class="mtm">
              <%= submit_tag "Create", class: "paxxxs bg-4 bg-2-hover c-14 c-15-hover full-width", data: { disable_with: "Creating" } %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
